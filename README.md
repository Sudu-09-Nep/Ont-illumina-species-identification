# ONT–Illumina Species Identification (16S-based)

This repository contains a **Snakemake workflow** to identify the likely species of a bacterial isolate from a **finished genome assembly** using **16S rRNA prediction** and **BLAST results**.

It is designed as a **downstream step** to the hybrid assembly workflow available here:
 [https://github.com/Sudu-09-Nep/ont-illumina-hybrid-assembly](https://github.com/Sudu-09-Nep/ont-illumina-hybrid-assembly)

---

## Project overview

* **Goal**
  Take a completed bacterial genome assembly, extract 16S rRNA sequences, and summarize species identity based on BLAST results.

* **Input**

  * A single assembled bacterial genome in FASTA format
  * A BLAST **text-only** report downloaded from NCBI (generated using the extracted 16S sequence)

* **Output**

  * rRNA predictions (GFF)
  * Extracted 16S rRNA sequences (FASTA)
  * A final species summary table: `species_call.tsv`

This project is intended to be used **after** the hybrid ONT/Illumina assembly workflow documented here:
 [https://github.com/Sudu-09-Nep/ont-illumina-hybrid-assembly](https://github.com/Sudu-09-Nep/ont-illumina-hybrid-assembly)

### Typical analysis flow

1. Assemble and polish the genome using the **hybrid assembly pipeline**
2. Use this **species identification pipeline** to infer species from the finished genome

---

## Repository structure

At the top level, this repository follows a standard Snakemake layout:

```text
.
├── config/              # Workflow configuration (YAML)
├── data/                # Input genome FASTA file(s)
├── envs/                # Conda environments (e.g. barrnap.yaml)
├── logs/                # Log files from Snakemake rules
├── results/             # Output files
└── workflow/
    └── Snakefile        # Main Snakemake workflow
```

### Typical outputs (single sample)

* `results/rRNA.gff`
  rRNA predictions generated by **barrnap**

* `results/16S_only.gff`
  Subset of rRNA annotations corresponding to 16S rRNA

* `results/16S.fasta`
  Extracted 16S rRNA sequences (used as BLAST queries)

* `results/species_call.tsv`
  Final tab-separated file summarizing species identity

---

## Installation and environment

### 1. Clone the repository

```bash
git clone https://github.com/Sudu-09-Nep/ont-illumina-species-identification.git
cd ont-illumina-species-identification
```

### 2. Create and activate the conda environment

```bash
conda env create -f envs/barrnap.yaml
conda activate snakemake
```

> The environment installs **barrnap** and required dependencies.
> Snakemake must be available either in this environment or installed separately.

### 3. Check Snakemake installation

```bash
snakemake --help
```

---

## Configuration

All run-specific parameters are defined in:

```text
config/config.yaml
```

### Example configuration

```yaml
genome_fasta: "data/genome.fasta"
blast_txt: "results/BLAST.txt"
sample: "my_sample"
```

### Configuration fields

* `genome_fasta`
  Path to the assembled genome FASTA file to analyze

* `blast_txt`
  Path to the BLAST **text-only** report downloaded from NCBI after blasting `results/16S.fasta`

* `sample`
  Sample name to appear in `species_call.tsv`

 **Important**:
All paths are **relative to the repository root**, not to `workflow/`.

---

## How to run the workflow (first sample)

### 1. Add your assembled genome

Copy your completed assembly into the `data/` directory:

```bash
cp /path/to/your/assembly.fasta data/genome.fasta
```

### 2. Edit the configuration file

```yaml
genome_fasta: "data/genome.fasta"
blast_txt: "results/BLAST.txt"
sample: "my_sample"
```

### 3. Run Snakemake

```bash
conda activate snakemake
snakemake -s workflow/Snakefile -j 4 --use-conda
```

This will:

* Predict rRNA genes using **barrnap**
* Extract 16S rRNA sequences into `results/16S.fasta`

---

## BLAST step (manual)

1. Take the file:

```text
results/16S.fasta
```

2. Upload it to **NCBI BLAST** (e.g. 16S rRNA BLAST).

3. Run the BLAST search.

4. Download the **text-only** BLAST report and save it as:

```text
results/BLAST.txt
```

---

## Final species calling

Once the BLAST report is present, re-run Snakemake if needed:

```bash
snakemake -s workflow/Snakefile -j 4 --use-conda
```

The workflow will parse the BLAST output and generate:

```text
results/species_call.tsv
```

Example output:

```text
sample        species
my_sample     Some_species_name
```

---

## Reproducing the analysis for a new assembled genome

For each new genome, you only need to update **three fields** in `config/config.yaml`.

### 1. Update the configuration

```yaml
genome_fasta: "data/genome_NEW.fasta"
blast_txt: "results/BLAST_NEW.txt"
sample: "my_new_sample"
```

### 2. Add the new genome

```bash
cp /path/to/your/new_assembly.fasta data/genome_NEW.fasta
```

### 3. Run the workflow

```bash
conda activate snakemake
snakemake -s workflow/Snakefile -j 4 --use-conda
```

### 4. BLAST the new 16S sequence

* BLAST `results/16S.fasta` on NCBI
* Download the text report as:

```text
results/BLAST_NEW.txt
```

### 5. Final run

```bash
snakemake -s workflow/Snakefile -j 4 --use-conda
```

Updated outputs will include:

* `results/rRNA.gff`
* `results/16S_only.gff`
* `results/16S.fasta`
* `results/species_call.tsv`

Example:

```text
sample          species
my_new_sample   Some_species_name
```

---

## Summary

For any unknown assembled bacterial genome:

1. Copy the FASTA file into `data/`
2. Update `genome_fasta`, `blast_txt`, and `sample` in `config/config.yaml`
3. Run Snakemake
4. BLAST the extracted 16S sequence
5. Read `results/species_call.tsv` for the species identification

---


